<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>B√°o c√°o thu ti·ªÅn - 8.ZENG‚Ñ¢</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <button id="darkModeToggle" class="dark-mode-toggle">üåô</button>

  <div id="notification-area"></div>
  
  <div id="loading-indicator">ƒêang x·ª≠ l√Ω...</div>

  <div id="homePage" class="page">
    <div class="simple-animated-logo">
        <span class="logo-char-1">Z</span>
        <span class="logo-char-2">E</span>
        <span class="logo-char-3">N</span>
        <span class="logo-char-4">G</span>
        <span class="logo-char-5 tm">‚Ñ¢</span>
      <span class="logo-char-6 8">8</span>
    </div>
    <h2>B√°o c√°o Thu Ti·ªÅn</h2>
    <div class="controls-panel">
        <label for="excelFile1">Ch·ªçn file Bi·ªÉu 31 (L√¥ t√¥):</label>
        <input type="file" id="excelFile1" accept=".xls,.xlsx">
        
        <label for="excelFile2">Ch·ªçn file Bi·ªÉu 35 (XSKT - T√πy ch·ªçn):</label>
        <input type="file" id="excelFile2" accept=".xls,.xlsx">
        
        <div class="home-actions">
            <button id="btnShowManualReport" class="warning">Th√™m B√°o c√°o</button>
            <button id="btnLoadData" class="success">N·∫°p d·ªØ li·ªáu</button>
        </div>
    </div>
    <div class="copyright">
        ¬© 2025 ZENG FINANCE
    </div>
  </div>
  
  <div id="mainPage" class="page" style="display: none;">
    <div class="simple-animated-logo main-page-logo">
        <span class="logo-char-1">Z</span>
        <span class="logo-char-2">E</span>
        <span class="logo-char-3">N</span>
        <span class="logo-char-4">G</span>
        <span class="logo-char-5 tm">‚Ñ¢</span>
    </div>

    <div class="main-nav">
        <button id="navSummary" class="active">B√°o c√°o T·ªïng h·ª£p</button>
        <button id="navReport">B√°o c√°o Chi ti·∫øt</button> <button id="navSell">B√°n th√™m v√©</button>
        <button id="navReload" class="warning">N·∫°p l·∫°i Excel</button>
    </div>

    <div id="summarySection" class="main-section">
        
        <div class="controls-panel" style="margin-bottom: 15px; padding: 15px;">
            <div class="filter-grid-container">
                <div class="filter-column">
                    <label for="regionDefinitionsInput">ƒê·ªãnh nghƒ©a v√πng (M·ªói v√πng 1 d√≤ng):</label>
                    <textarea id="regionDefinitionsInput" rows="4" placeholder="V√≠ d·ª•:&#10;huy·ªán √ù Y√™n: 550_599+650_699+6999&#10;huy·ªán V·ª• B·∫£n: 200_299+350_450"></textarea>
                    <button id="btnSaveRegions" class="success">L∆∞u ƒê·ªãnh nghƒ©a</button>
                </div>
                
                <div class="filter-column">
                    <label for="regionSelect">Ch·ªçn ƒê∆°n v·ªã:</label>
                    <div class="inline-form" style="flex-wrap: nowrap;"> 
                        <select id="regionSelect" style="flex-grow: 1;">
                            <option value="all">--- T·∫•t c·∫£ ---</option>
                            </select>
                        <button id="btnClearSummaryFilter" class="secondary" style="flex-grow: 0; margin-left: 10px;">Xo√° l·ªçc</button>
                    </div>

                    <label for="filterMinAmount" style="margin-top: 10px;">L·ªçc Doanh s·ªë (K) - T·ª´:</label>
                    <input type="number" id="filterMinAmount" placeholder="Nh·∫≠p s·ªë (K), v√≠ d·ª•: 100" style="padding: 10px 12px; font-size: 15px;">
                    
                    <label for="filterMaxAmount">L·ªçc Doanh s·ªë (K) - ƒê·∫øn:</label>
                    <input type="number" id="filterMaxAmount" placeholder="Nh·∫≠p s·ªë (K), v√≠ d·ª•: 500" style="padding: 10px 12px; font-size: 15px;">
                    
                    <button id="btnClearAmountFilter" class="secondary" style="margin-top: 5px;">Xo√° l·ªçc ti·ªÅn</button>
                    </div>
            </div>
        </div>
        <h3 id="summaryTitle">B·∫£ng B√°o C√°o T·ªïng H·ª£p:</h3>
        <h4 id="summaryDate" class="report-date"></h4>
        
        <div id="summaryTableContainer"></div>
        <div class="summary-actions">
            <button id="btnCopySummary" class="success">Copy ·∫¢nh</button>
            <button id="btnSaveSummary" class="secondary">T·∫£i ·∫£nh</button>
        </div>
    </div>

    <div id="reportSection" class="main-section" style="display: none;">
        <h3>T·∫°o B√°o C√°o Chi Ti·∫øt</h3>
        <div class="controls-panel">
            <label for="soSoInput">Nh·∫≠p s·ªë s·ªï (v√≠ d·ª•: 550):</label>
            <div class="inline-form">
                <input type="text" id="soSoInput" inputmode="numeric" placeholder="Nh·∫≠p s·ªë s·ªï...">
            </div>
            <div class="report-actions-grid">
                <button id="btnCreateReport">T·∫°o b√°o c√°o</button>
                <button id="btnShowManualReport_inline" class="warning">Th√™m B√°o c√°o</button>
            </div>
        </div>
        
        <div id="reportContainer"></div>
        <div id="actionButtonContainer">
            <button id="btnCopyReport">Copy ·∫¢nh</button>
            <button id="toggleChoicesBtn" class="secondary">Th√™m ti·ªÅn Th∆∞·ªüng/N·ª£</button>
            <div id="actionChoices"></div>
        </div>
    </div>

    <div id="sellSection" class="main-section" style="display: none;">
        <h3>B√°n th√™m V√© (Th√™m v√†o B√°o c√°o chi ti·∫øt)</h3>
        <p class="context-note">V√© s·∫Ω ƒë∆∞·ª£c th√™m v√†o b√°o c√°o chi ti·∫øt ƒëang ƒë∆∞·ª£c hi·ªÉn th·ªã.</p>
        <div id="sellTicketControls" class="controls-panel">
            <div>
                <label>Lo·∫°i h√¨nh:</label>
                <div class="ticket-type-selector">
                    <label><input type="radio" name="sellTicketType" value="xo-so" checked> X·ªï s·ªë</label>
                    <label><input type="radio" name="sellTicketType" value="ve-boc"> V√© b√≥c</label>
                    <label><input type="radio" name="sellTicketType" value="custom-name"> T·ª± nh·∫≠p t√™n</label>
                </div>
                <input type="text" id="customTicketName" placeholder="Nh·∫≠p t√™n lo·∫°i h√¨nh..." style="display:none; margin-top: 5px;">
            </div>
            <div>
                <label>Gi√° b√°n:</label>
                <div class="ticket-type-selector">
                    <label><input type="radio" name="sellPrice" value="10000" checked> 10.000</label>
                    <label><input type="radio" name="sellPrice" value="20000"> 20.000</label>
                    <label><input type="radio" name="sellPrice" value="5000"> 5.000</label>
                    <label><input type="radio" name="sellPrice" value="custom-price"> T·ª± nh·∫≠p gi√°</label>
                </div>
                <input type="text" id="customTicketPrice" inputmode="numeric" placeholder="Nh·∫≠p gi√° b√°n..." style="display:none; margin-top: 5px;">
            </div>
            <div>
                <label>Hoa h·ªìng:</label>
                <div class="ticket-type-selector">
                    <label><input type="radio" name="commissionRate" value="0.10" checked> 10%</label>
                    <label><input type="radio" name="commissionRate" value="0.12"> 12%</label>
                    <label><input type="radio" name="commissionRate" value="custom-commission"> T·ª± nh·∫≠p %</label>
                </div>
                <input type="number" id="customCommissionPercent" placeholder="Nh·∫≠p % hoa h·ªìng (v√≠ d·ª•: 15)" style="display:none; margin-top: 5px;" min="0">
            </div>
            <div>
                <label for="sellQuantityInput">S·ªë l∆∞·ª£ng:</label>
                <input type="number" id="sellQuantityInput" placeholder="Nh·∫≠p s·ªë l∆∞·ª£ng v√©..." min="0">
            </div>
            <button id="btnAddTicket" class="success">Th√™m v√© v√†o b√°o c√°o</button>
        </div>
    </div>
  </div>

   <div id="manualInputModal" class="modal-overlay">
     <div class="modal-content">
       <span id="closeModalBtn" class="modal-close-btn">&times;</span>
       <div id="manualReportFormContent" class="controls-panel"> 
           <h4 style="margin-top:0; text-align:center;">Th√™m B√°o C√°o Th·ªß C√¥ng</h4>
           
           <div class="manual-grid">
               <label for="manualAgentName">T√™n ƒê·∫°i L√Ω:</label>
               <input type="text" id="manualAgentName" placeholder="T·ª± nh·∫≠p...">
               <label for="manualDateRange">Th·ªùi gian:</label>
               <input type="text" id="manualDateRange" placeholder="T·ª± nh·∫≠p...">
               <label for="manualLotoDB">L√¥ t√¥ ƒê·∫∑c bi·ªát:</label>
               <input type="text" id="manualLotoDB" inputmode="numeric" class="manual-currency" placeholder="Nh·∫≠p doanh thu...">
               <label for="manualLoCap">L√¥ c·∫∑p:</label>
               <input type="text" id="manualLoCap" inputmode="numeric" class="manual-currency" placeholder="Nh·∫≠p doanh thu...">
               <label for="manualC227">2/27:</label>
               <input type="text" id="manualC227" inputmode="numeric" class="manual-currency" placeholder="Nh·∫≠p doanh thu...">
               <label for="manualC323">3/23:</label>
               <input type="text" id="manualC323" inputmode="numeric" class="manual-currency" placeholder="Nh·∫≠p doanh thu...">
               <label for="manualThuong">Th∆∞·ªüng:</label>
               <input type="text" id="manualThuong" inputmode="numeric" class="manual-currency" placeholder="Nh·∫≠p ti·ªÅn th∆∞·ªüng...">
           </div>
           <div class="form-actions" style="margin-top: 15px;">
               <button id="btnClearManualReport" class="secondary">Xo√°</button>
               <button id="btnCreateManualReport" class="success">Th√™m</button>
           </div>
       </div>
     </div>
   </div>

   <div id="imagePreviewModal" class="modal-overlay">
     <div class="modal-content">
       <span id="closePreviewModalBtn" class="modal-close-btn">&times;</span>
       <h4 style="margin-top:0; text-align:center;">Sao ch√©p ·∫¢nh B√°o c√°o</h4>
       <p style="text-align: center; color: var(--text-light); margin-top: -10px;">
           Nh·∫•n chu·ªôt ph·∫£i v√†o ·∫£nh d∆∞·ªõi ƒë√¢y v√† ch·ªçn "Sao ch√©p h√¨nh ·∫£nh":
       </p>
       <img id="imagePreviewHolder" src="" alt="B·∫£n xem tr∆∞·ªõc b√°o c√°o" style="width: 100%; border: 1px solid var(--border-color); border-radius: 4px; user-select: auto; -webkit-user-select: auto;">
     </div>
   </div>

    <div id="reloadModal" class="modal-overlay">
      <div class="modal-content">
        <span id="closeReloadModalBtn" class="modal-close-btn">&times;</span>
        <div id="reloadFormContent" class="controls-panel" style="border: none; box-shadow: none; padding: 10px 0;"> 
            <h4 style="margin-top:0; text-align:center;">N·∫°p l·∫°i File Excel</h4>
            
            <label for="reloadFile1">Ch·ªçn file Bi·ªÉu 31 (L√¥ t√¥):</label>
            <input type="file" id="reloadFile1" accept=".xls,.xlsx">
            
            <label for="reloadFile2">Ch·ªçn file Bi·ªÉu 35 (XSKT - T√πy ch·ªçn):</label>
            <input type="file" id="reloadFile2" accept=".xls,.xlsx">
            
            <button id="btnReloadSubmit" class="success" style="margin-top: 15px;">N·∫°p</button>
        </div>
      </div>
    </div>

    <div id="passwordModal" class="modal-overlay">
      <div class="modal-content">
        <span id="closePasswordModalBtn" class="modal-close-btn">&times;</span>
        <div class="controls-panel" style="border: none; box-shadow: none; padding: 10px 0;"> 
            <h4 style="margin-top:0; text-align:center;">Y√™u c·∫ßu M·∫≠t kh·∫©u</h4>
            <label for="passwordInput">Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ ch·ªânh s·ª≠a:</label>
            <input type="password" id="passwordInput" style="font-size: 18px;">
            <div class="form-actions" style="margin-top: 15px;">
                <button id="cancelPasswordBtn" class="secondary">Hu·ª∑</button>
                <button id="btnSubmitPassword" class="success">X√°c nh·∫≠n</button>
            </div>
        </div>
      </div>
    </div>

  <button id="scrollToTopBtn" title="Cu·ªôn l√™n ƒë·∫ßu trang">&#9650;</button>
  <button id="scrollToBottomBtn" title="Cu·ªôn xu·ªëng d∆∞·ªõi">&#9660;</button>
  
  <script src="js/main.js" type="module"></script>
</body>
</html>