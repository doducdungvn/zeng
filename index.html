<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Player Tool</title>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f4f9;
        }
        h1, h2 {
            color: #333;
        }
        #fileInput {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            display: block;
            width: 100%;
            box-sizing: border-box;
        }
        #playlist {
            list-style: none;
            padding: 0;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fff;
        }
        #playlist li {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            font-size: 0.9em;
            word-break: break-all;
        }
        #playlist li:last-child {
            border-bottom: none;
        }
        #playlist li:hover {
            background-color: #e9e9e9;
        }
        .active-track {
            background-color: #007bff !important;
            color: white;
            font-weight: bold;
        }
        #audioPlayer {
            width: 100%;
            margin-top: 15px;
        }
        #currentTrack {
            padding: 10px 0;
            font-style: italic;
            color: #555;
        }
    </style>
</head>
<body>
    <h1>üéß Web Player ƒê∆°n Gi·∫£n</h1>

    <input 
        type="file" 
        id="fileInput" 
        accept="audio/*, video/*" 
        multiple 
        webkitdirectory
    >

    <hr>

    <h2>Danh s√°ch ph√°t</h2>
    <p id="currentTrack">Ch∆∞a c√≥ b√†i n√†o ƒëang ph√°t.</p>
    
    <ul id="playlist">
        <li id="empty-message">Vui l√≤ng ch·ªçn **th∆∞ m·ª•c** ho·∫∑c **file nh·∫°c/video** ƒë·ªÉ th√™m v√†o danh s√°ch.</li>
    </ul>

    <hr>

    <h2>Tr√¨nh ph√°t</h2>
    <audio id="audioPlayer" controls autoplay></audio>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const fileInput = document.getElementById('fileInput');
            const playlist = document.getElementById('playlist');
            const audioPlayer = document.getElementById('audioPlayer');
            const currentTrackDisplay = document.getElementById('currentTrack');
            const emptyMessage = document.getElementById('empty-message');

            let trackList = [];
            let currentTrackIndex = -1;

            // --- 1. X·ª≠ l√Ω khi ng∆∞·ªùi d√πng ch·ªçn file/th∆∞ m·ª•c ---
            fileInput.addEventListener('change', (event) => {
                const files = event.target.files;
                if (files.length > 0) {
                    // Reset danh s√°ch c≈©
                    playlist.innerHTML = '';
                    trackList = [];
                    currentTrackIndex = -1;

                    // L·ªçc v√† th√™m file h·ª£p l·ªá
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        if (file.type.startsWith('audio/') || file.type.startsWith('video/')) {
                            trackList.push(file);
                            addTrackToPlaylist(file, trackList.length - 1);
                        }
                    }
                    
                    // T·ª± ƒë·ªông ph√°t b√†i ƒë·∫ßu ti√™n n·∫øu c√≥
                    if (trackList.length > 0) {
                        playTrack(0);
                    } else {
                        playlist.innerHTML = '<li id="empty-message">Kh√¥ng t√¨m th·∫•y file nh·∫°c/video n√†o h·ª£p l·ªá trong th∆∞ m·ª•c ƒë√£ ch·ªçn.</li>';
                    }
                }
            });

            // --- 2. Th√™m b√†i h√°t v√†o danh s√°ch hi·ªÉn th·ªã ---
            function addTrackToPlaylist(file, index) {
                const li = document.createElement('li');
                
                // Hi·ªÉn th·ªã ƒë∆∞·ªùng d·∫´n t∆∞∆°ng ƒë·ªëi n·∫øu c√≥ (khi ch·ªçn th∆∞ m·ª•c)
                const trackName = file.webkitRelativePath || file.name;
                li.textContent = trackName; 
                li.dataset.index = index; 
                
                li.addEventListener('click', () => {
                    playTrack(index);
                });

                playlist.appendChild(li);
            }

            // --- 3. H√†m ph√°t nh·∫°c ch√≠nh ---
            function playTrack(index) {
                if (index >= 0 && index < trackList.length) {
                    currentTrackIndex = index;
                    const file = trackList[index];

                    // T·∫°o URL ƒë·ªëi t∆∞·ª£ng cho file ƒë√£ ch·ªçn
                    const fileURL = URL.createObjectURL(file);
                    
                    // Thi·∫øt l·∫≠p ngu·ªìn v√† b·∫Øt ƒë·∫ßu ph√°t
                    audioPlayer.src = fileURL;
                    audioPlayer.load();
                    audioPlayer.play().catch(error => {
                        console.error("L·ªói khi c·ªë g·∫Øng ph√°t nh·∫°c:", error);
                        currentTrackDisplay.textContent = `‚ñ∂Ô∏è ${file.name} - (Click n√∫t Play ƒë·ªÉ b·∫Øt ƒë·∫ßu)`;
                    });

                    // C·∫≠p nh·∫≠t th√¥ng tin v√† highlight
                    const trackNameDisplay = file.webkitRelativePath || file.name;
                    currentTrackDisplay.innerHTML = `üé∂ **ƒêang ph√°t:** ${trackNameDisplay}`;
                    highlightActiveTrack(index);
                }
            }

            // --- 4. T·ª± ƒë·ªông chuy·ªÉn b√†i khi k·∫øt th√∫c ---
            audioPlayer.addEventListener('ended', () => {
                if (currentTrackIndex < trackList.length - 1) {
                    playTrack(currentTrackIndex + 1); // Ph√°t b√†i ti·∫øp theo
                } else {
                    // ƒê√£ h·∫øt danh s√°ch
                    currentTrackDisplay.innerHTML = "‚úÖ **Danh s√°ch ph√°t ƒë√£ ho√†n th√†nh.**";
                    highlightActiveTrack(-1); // B·ªè highlight
                }
            });

            // --- 5. Highlight b√†i ƒëang ph√°t ---
            function highlightActiveTrack(index) {
                const items = playlist.querySelectorAll('li');
                items.forEach(item => {
                    item.classList.remove('active-track');
                });

                if (index !== -1) {
                    const activeItem = playlist.querySelector(`li[data-index="${index}"]`);
                    if (activeItem) {
                        activeItem.classList.add('active-track');
                        // Cu·ªôn ƒë·∫øn b√†i ƒëang ph√°t
                        activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }
                }
            }
        });
    </script>
</body>
</html>
